<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Kliniksuche â€“ BFHI</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --blue:    #004a99;
    --orange:  #ff8c00;
    --grey:    #bdc3c7;
    --radius:  14px;
  }

  html, body { height: 100%; width: 100%; overflow: hidden; font-family: 'Segoe UI', Roboto, sans-serif; background: #eee; }

  /* â”€â”€ Layout â”€â”€ */
  #app { display: flex; height: 100%; width: 100%; }
  #map { flex: 1; height: 100%; z-index: 1; }

  /* â”€â”€ Sidebar Desktop â”€â”€ */
  #sidebar {
    width: 400px; min-width: 400px; height: 100%;
    display: flex; flex-direction: column;
    background: white; z-index: 10;
    box-shadow: 2px 0 20px rgba(0,0,0,0.12);
  }

  /* â”€â”€ Sidebar Mobile: Bottom Sheet â”€â”€ */
  @media (max-width: 768px) {
    #app { flex-direction: column; position: relative; }
    #map { position: absolute; inset: 0; height: 100%; width: 100%; }
    #sidebar {
      position: absolute; bottom: 0; left: 0; right: 0;
      width: 100%; min-width: unset; height: 88vh;
      border-radius: 22px 22px 0 0;
      box-shadow: 0 -4px 24px rgba(0,0,0,0.18);
      transform: translateY(calc(88vh - 170px));
      transition: transform 0.32s cubic-bezier(0.25,0.46,0.45,0.94);
      will-change: transform;
    }
    #sidebar.open { transform: translateY(0); }
  }

  /* â”€â”€ Header â”€â”€ */
  #header {
    background: var(--blue); color: white;
    padding: 18px 20px 22px; flex-shrink: 0; cursor: default;
  }
  .drag-handle {
    width: 44px; height: 5px; background: rgba(255,255,255,0.35);
    border-radius: 10px; margin: 0 auto 14px; display: none;
    cursor: grab;
  }
  @media (max-width: 768px) { .drag-handle { display: block; } }

  #header h1 { font-size: 20px; text-align: center; margin-bottom: 14px; font-weight: 700; letter-spacing: 0.3px; }

  .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
  .input-row.single { grid-template-columns: 1fr; }

  #header input, #header select {
    width: 100%; padding: 11px 14px; border-radius: 10px; border: none;
    font-size: 15px; background: white; color: #222;
    -webkit-appearance: none; appearance: none; outline: none;
  }
  #header select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%23666' d='M6 8L0 0h12z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px; }

  .btn-row { display: flex; gap: 10px; margin-top: 10px; }
  .btn-search { flex: 2; padding: 13px; background: var(--orange); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; transition: background 0.2s; }
  .btn-search:hover { background: #e07b00; }
  .btn-reset  { flex: 1; padding: 13px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 10px; font-size: 15px; cursor: pointer; transition: background 0.2s; }
  .btn-reset:hover { background: rgba(255,255,255,0.3); }

  /* â”€â”€ Legend â”€â”€ */
  #legend {
    display: flex; gap: 18px; justify-content: center;
    padding: 10px 16px; font-size: 12px; color: #555;
    background: #fafafa; border-bottom: 1px solid #eee; flex-shrink: 0;
  }
  .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; vertical-align: middle; }

  /* â”€â”€ Results â”€â”€ */
  #results { overflow-y: auto; flex: 1; -webkit-overflow-scrolling: touch; }

  .empty-state { padding: 40px 20px; text-align: center; color: #999; font-size: 15px; }
  .empty-state .icon { font-size: 40px; margin-bottom: 12px; }

  /* â”€â”€ Klinik Card â”€â”€ */
  .card {
    padding: 18px 20px; border-bottom: 1px solid #f0f0f0;
    cursor: pointer; transition: background 0.15s;
  }
  .card:hover { background: #f9f9f9; }
  .card.active { background: #fff4e6; border-left: 4px solid var(--orange); }

  .card-top { display: flex; justify-content: space-between; align-items: flex-start; gap: 8px; }
  .card-name { font-size: 15px; font-weight: 700; color: #1a1a1a; line-height: 1.3; }
  .card-dist { font-size: 11px; font-weight: 700; color: var(--blue); white-space: nowrap; margin-top: 2px; }
  .card-typ  { font-size: 12px; color: #d35400; font-style: italic; margin: 5px 0 4px; }
  .card-addr { font-size: 12px; color: #666; line-height: 1.5; }

  .badge {
    display: inline-block; padding: 3px 10px; border-radius: 20px;
    font-size: 10px; font-weight: 700; color: white; margin-top: 8px;
  }

  .card-actions { display: flex; gap: 8px; margin-top: 12px; }
  .btn-web {
    flex: 1; padding: 9px; border-radius: 8px; text-decoration: none;
    font-size: 13px; font-weight: 600; text-align: center;
    background: var(--blue); color: white; transition: background 0.2s;
  }
  .btn-web:hover { background: #003a7a; }

  /* â”€â”€ URL Bar â”€â”€ */
  #urlbar {
    padding: 8px 16px; background: #f0f4f8; border-top: 1px solid #e0e0e0;
    font-size: 11px; color: #888; text-align: center; flex-shrink: 0;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }

  /* â”€â”€ Toast â”€â”€ */
  #toast {
    position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(20px);
    background: #333; color: white; padding: 11px 22px; border-radius: 30px;
    font-size: 13px; font-weight: 600; z-index: 9999;
    opacity: 0; pointer-events: none;
    transition: opacity 0.25s, transform 0.25s;
    white-space: nowrap;
  }
  #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* â”€â”€ Loader â”€â”€ */
  #loader {
    position: absolute; inset: 0; background: rgba(255,255,255,0.85);
    display: flex; align-items: center; justify-content: center;
    z-index: 9998; flex-direction: column; gap: 14px;
  }
  .spinner {
    width: 40px; height: 40px; border: 4px solid #e0e0e0;
    border-top-color: var(--blue); border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div id="app">
  <div id="map"></div>

  <div id="sidebar">
    <div class="drag-handle" id="dragHandle"></div>

    <div id="header">
      <h1>ğŸ¥ Kliniksuche</h1>
      <div class="input-row single">
        <input type="text" id="plzInput" placeholder="PLZ eingeben (z.B. 10115)" inputmode="numeric" maxlength="5" aria-label="Postleitzahl">
      </div>
      <div class="input-row">
        <select id="radiusInput" aria-label="Suchradius">
          <option value="20">20 km</option>
          <option value="50" selected>50 km</option>
          <option value="100">100 km</option>
          <option value="200">200 km</option>
        </select>
        <select id="typInput" aria-label="Kliniktyp">
          <option value="">Alle Typen</option>
          <option value="Geburtsklinik">Geburtsklinik</option>
          <option value="Kinderklinik">Kinderklinik</option>
          <option value="Neonatologie">Neonatologie</option>
          <option value="Perinatalklinik">Perinatalklinik</option>
        </select>
      </div>
      <div class="btn-row">
        <button class="btn-search" id="btnSuchen">ğŸ” SUCHEN</button>
        <button class="btn-reset"  id="btnReset">â†º RESET</button>
      </div>
    </div>

    <div id="legend">
      <span><span class="dot" style="background:var(--orange)"></span>Zertifiziert</span>
      <span><span class="dot" style="background:var(--grey)"></span>Noch nicht zertifiziert</span>
    </div>

    <div id="results">
      <div class="empty-state"><div class="icon">â³</div>Daten werden geladenâ€¦</div>
    </div>

    <div id="urlbar" title="Aktuelle Such-URL">bfhi.github.io/kliniksuche</div>
  </div>
</div>

<div id="loader"><div class="spinner"></div><span style="color:#555;font-size:14px;">Kliniken ladenâ€¦</span></div>
<div id="toast"></div>

<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script>
// â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DATA_URL = 'https://cdn.jsdelivr.net/gh/BFHI/kliniksuche@main/kliniken.json';

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const state = {
  kliniken: [],
  filter:   { plz: '', lat: null, lon: null, radius: 50, typ: '' },
  treffer:  [],
  activeId: null
};

// â”€â”€ Karte â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const map = L.map('map', { zoomControl: false }).setView([51.1657, 10.4515], 6);
L.control.zoom({ position: 'topright' }).addTo(map);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap'
}).addTo(map);

const cluster = L.markerClusterGroup({
  maxClusterRadius: 50, showCoverageOnHover: false, spiderfyOnMaxZoom: true
});
map.addLayer(cluster);

const markerMap = new Map();

map.on('click', () => {
  if (isMobile()) sidebar.classList.remove('open');
});

// â”€â”€ DOM Refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const sidebar    = document.getElementById('sidebar');
const plzInput   = document.getElementById('plzInput');
const radiusInput= document.getElementById('radiusInput');
const typInput   = document.getElementById('typInput');
const results    = document.getElementById('results');
const urlbar     = document.getElementById('urlbar');
const loader     = document.getElementById('loader');

const isMobile = () => window.innerWidth <= 768;

// â”€â”€ Touch Swipe â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let touchY0 = 0, translateY0 = 0, dragging = false;
const snapThreshold = () => window.innerHeight * 0.88 * 0.45;

function getTranslateY() {
  return new WebKitCSSMatrix(window.getComputedStyle(sidebar).transform).m42;
}

document.getElementById('dragHandle').addEventListener('touchstart', e => {
  if (!isMobile()) return;
  dragging = true; touchY0 = e.touches[0].clientY; translateY0 = getTranslateY();
  sidebar.style.transition = 'none';
}, { passive: true });

document.addEventListener('touchmove', e => {
  if (!dragging) return;
  const delta = e.touches[0].clientY - touchY0;
  const maxY  = window.innerHeight * 0.88 - 170;
  sidebar.style.transform = `translateY(${Math.max(0, Math.min(maxY, translateY0 + delta))}px)`;
}, { passive: true });

document.addEventListener('touchend', () => {
  if (!dragging) return;
  dragging = false; sidebar.style.transition = '';
  const cur = getTranslateY();
  if (cur < snapThreshold()) { sidebar.classList.add('open');    sidebar.style.transform = ''; }
  else                        { sidebar.classList.remove('open'); sidebar.style.transform = ''; }
});

document.getElementById('dragHandle').addEventListener('click', () => {
  if (isMobile()) sidebar.classList.toggle('open');
});

// â”€â”€ URL Parameter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function leseURL() {
  const p = new URLSearchParams(location.search);
  if (p.get('plz'))    plzInput.value    = p.get('plz');
  if (p.get('radius')) radiusInput.value = p.get('radius');
  if (p.get('typ'))    typInput.value    = p.get('typ');
}

function schreibeURL() {
  const p = new URLSearchParams();
  if (state.filter.plz)    p.set('plz',    state.filter.plz);
  if (state.filter.radius) p.set('radius', state.filter.radius);
  if (state.filter.typ)    p.set('typ',    state.filter.typ);
  const url = p.toString() ? `?${p}` : location.pathname;
  history.replaceState(null, '', url);
  urlbar.textContent = 'bfhi.github.io/kliniksuche' + (p.toString() ? '?' + p : '');
}

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let toastTimer;
function toast(msg, color = '#333') {
  const el = document.getElementById('toast');
  el.textContent = msg; el.style.background = color;
  el.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('show'), 3500);
}

// â”€â”€ Daten laden â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function datenLaden() {
  try {
    const res  = await fetch(DATA_URL);
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const json = await res.json();
    state.kliniken = json.kliniken
      .filter(k => k.aktiv && !isNaN(k.lat) && !isNaN(k.lon))
      .map(k => ({
        ...k,
        _jLat: k.lat + (Math.random() - 0.5) * 0.005,
        _jLon: k.lon + (Math.random() - 0.5) * 0.005
      }));
    loader.style.display = 'none';
    leseURL();
    if (plzInput.value) {
      await sucheStarten();
    } else {
      alleAnzeigen();
    }
  } catch(e) {
    loader.style.display = 'none';
    toast('âš ï¸ Daten konnten nicht geladen werden.', '#c0392b');
    results.innerHTML = `<div class="empty-state"><div class="icon">âš ï¸</div>Daten nicht verfÃ¼gbar.<br><small>Bitte spÃ¤ter erneut versuchen.</small></div>`;
  }
}

// â”€â”€ Suche â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function sucheStarten() {
  const plz    = plzInput.value.trim();
  const radius = parseInt(radiusInput.value);
  const typ    = typInput.value;

  if (!plz) { toast('âš ï¸ Bitte eine PLZ eingeben.', '#e67e22'); return; }
  if (!/^\d{5}$/.test(plz)) { toast('âš ï¸ Bitte eine gÃ¼ltige 5-stellige PLZ eingeben.', '#e67e22'); return; }

  try {
    const res  = await fetch(`https://nominatim.openstreetmap.org/search?format=json&postalcode=${plz}&country=germany`);
    const data = await res.json();
    if (!data.length) { toast(`âŒ PLZ ${plz} nicht gefunden.`, '#c0392b'); return; }

    const sLat = parseFloat(data[0].lat), sLon = parseFloat(data[0].lon);
    state.filter = { plz, lat: sLat, lon: sLon, radius, typ };

    state.treffer = state.kliniken
      .map(k => ({ ...k, _dist: distanz(sLat, sLon, k.lat, k.lon) }))
      .filter(k => k._dist <= radius && (!typ || k.typ.includes(typ)))
      .sort((a, b) => a._dist - b._dist);

    if (!state.treffer.length) toast(`Keine Kliniken im Umkreis von ${radius} km gefunden.`, '#7f8c8d');

    map.setView([sLat, sLon], 10);
    drawMarkers(state.treffer);
    renderListe(state.treffer, true);
    schreibeURL();
    if (isMobile()) sidebar.classList.add('open');

  } catch(e) {
    toast('âš ï¸ Netzwerkfehler. Bitte erneut versuchen.', '#c0392b');
  }
}

function alleAnzeigen() {
  plzInput.value = ''; radiusInput.value = 50; typInput.value = '';
  state.filter   = { plz: '', lat: null, lon: null, radius: 50, typ: '' };
  state.treffer  = state.kliniken;
  map.setView([51.1657, 10.4515], 6);
  drawMarkers(state.kliniken);
  renderListe(state.kliniken, false);
  schreibeURL();
}

// â”€â”€ Distanz â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function distanz(lat1, lon1, lat2, lon2) {
  const R = 6371, dLat = (lat2-lat1)*Math.PI/180, dLon = (lon2-lon1)*Math.PI/180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

// â”€â”€ Marker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawMarkers(daten) {
  cluster.clearLayers(); markerMap.clear();
  daten.forEach(k => {
    const zert   = k.zertifiziert;
    const marker = L.circleMarker([k._jLat, k._jLon], {
      radius: zert ? 11 : 7.5, fillColor: zert ? '#ff8c00' : '#bdc3c7',
      color: '#fff', weight: 1.5, fillOpacity: 0.88
    });
    const popup = document.createElement('div');
    popup.innerHTML = `<b>${k.firmenname}</b><br><small>${k.typ.join(', ')}</small><br><small style="color:#888">Tippen fÃ¼r Details</small>`;
    popup.style.cursor = 'pointer';
    popup.onclick = () => highlightCard(k.id);
    marker.bindPopup(popup);
    marker.on('click', () => highlightCard(k.id));
    cluster.addLayer(marker);
    markerMap.set(k.id, marker);
  });
}

// â”€â”€ Liste â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderListe(daten, mitDistanz) {
  if (!daten.length) {
    results.innerHTML = `<div class="empty-state"><div class="icon">ğŸ”</div>Keine Kliniken gefunden.</div>`;
    return;
  }
  results.innerHTML = daten.map(k => {
    const zert = k.zertifiziert;
    const url  = k.webseite ? (k.webseite.startsWith('http') ? k.webseite : 'https://' + k.webseite) : null;
    return `<div class="card" id="card-${k.id}" onclick="fokusKlinik('${k.id}', ${k.lat}, ${k.lon})">
      <div class="card-top">
        <div class="card-name">${k.firmenname}</div>
        ${mitDistanz ? `<div class="card-dist">${k._dist.toFixed(1).replace('.',',')} km</div>` : ''}
      </div>
      <div class="card-typ">${k.typ.join(' Â· ')}</div>
      <div class="card-addr">${k.strasse}<br>${k.plz} ${k.ort}</div>
      <span class="badge" style="background:${zert ? '#ff8c00' : '#bdc3c7'}">${zert ? 'âœ“ Zertifiziert' : 'Noch nicht zertifiziert'}</span>
      ${url ? `<div class="card-actions"><a href="${url}" target="_blank" class="btn-web" onclick="event.stopPropagation()">ğŸŒ Webseite</a></div>` : ''}
    </div>`;
  }).join('');
}

// â”€â”€ Interaktion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function highlightCard(id) {
  document.querySelectorAll('.card.active').forEach(el => el.classList.remove('active'));
  const el = document.getElementById('card-' + id);
  if (!el) return;
  if (isMobile()) sidebar.classList.add('open');
  setTimeout(() => {
    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
    el.classList.add('active');
  }, 200);
  state.activeId = id;
}

function fokusKlinik(id, lat, lon) {
  if (isMobile()) sidebar.classList.remove('open');
  map.setView([lat, lon], 14);
  const m = markerMap.get(id);
  if (m) cluster.zoomToShowLayer(m, () => m.openPopup());
}

// â”€â”€ Events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
plzInput.addEventListener('keydown', e => { if (e.key === 'Enter') sucheStarten(); });
document.getElementById('btnSuchen').addEventListener('click', sucheStarten);
document.getElementById('btnReset').addEventListener('click', alleAnzeigen);

// â”€â”€ Start â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
datenLaden();
</script>
</body>
</html>